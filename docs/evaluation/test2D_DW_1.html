<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>ctsimu.evaluation.test2D_DW_1 API documentation</title>
<meta name="description" content="Test 2D-DW-1: Detector unsharpness â€¦">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<link rel="icon" href="https://bamresearch.github.io/ctsimu-toolbox/toolbox.png">
<style>
thead {
border-top: 2px solid #000;
border-bottom:1px solid #000;
}
tbody {
border-bottom: 2px solid #000;
}
th, td {
padding: 0.1em;
padding-right: 1em;
white-space: nowrap;
}
tr:hover {background-color: #eee;}
</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ctsimu.evaluation.test2D_DW_1</code></h1>
</header>
<section id="section-intro">
<h1 id="test-2d-dw-1-detector-unsharpness">Test 2D-DW-1: Detector unsharpness</h1>
<p>This test employs a sample of duplex wires (DIN EN 462-5 or <a href="https://dx.doi.org/10.31030/2857038">ISO 19232-5</a>) to check if the required basic spatial resolution (SR<sub>b</sub>) is simulated correctly. It uses the technique presented in <a href="https://doi.org/10.1520/E2002">ASTM E2002-15</a> to calculate the interpolated basic spatial resolution (iSR<sub>b</sub>) using a line profile across the duplex wires sample.</p>
<p>This scenario defines two subtests: one with a basic spatial resolution of SR<sub>b,1</sub> = 75 &mu;m, and a second one with SR<sub>b,2</sub> = 150 &mu;m. The following code example shows how to identify each sub-test correctly when using the toolbox with metadata files to run the evaluation.</p>
<pre><code class="language-python">from ctsimu.toolbox import Toolbox
Toolbox(&quot;2D-DW-1&quot;,
    SR75  = &quot;2D-DW-1_75um_metadata.json&quot;,
    SR150 = &quot;2D-DW-1_150um_metadata.json&quot;
)
</code></pre>
<p>A line profile is measured perpendicular to the duplex wires at a tilt angle of 3&deg;, with a line width of <em>w</em> = 20 px and a resolution of <em>r</em> = 0.1 px. The profile has a length of <em>l</em> = 1050 px; its start and end point are given and illustrated in the following picture.</p>
<p><img alt="Duplex wire" src="../pictures/duplex_wire.png" title="Line profile across duplex wire"></p>
<p>The evaluation follows the procedure described in <a href="https://doi.org/10.1520/E2002">ASTM E2002-15</a> to calculate the interpolated basic spatial resolution (iSR<sub>b</sub>). The modulation depth is measured for each wire pair, defined as the ratio of the height of its central peak above the two dips to the depth of its dips against the background intensity. For the interpolation, a quadratic function is fit to the last point that has a modulation depth of more than 20% and its neighborhood of nearest and next-nearest neighbors, as long as they have a modulation depth of at least 1.5%.</p>
<p><img alt="Example results for 150um" src="../pictures/2D-DW-1_SR150_results.png" title="Example results for 150um"></p>
<p>The upper picture shows an example for a line profile across the duplex wire pairs at a simulated basic spatial resolution of SR<sub>b,2</sub> = 150 &mu;m for a pixel size of 50 &mu;m.</p>
<p>The lower picture shows the identified modulation depths as a function of the wire spacing. The dotted line shows the quadratic interpolation function, the cross designates the interpolated iSR<sub>b</sub> = 147 &mu;m at a modulation depth of 20%.</p>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1"><code class="flex name class">
<span>class <span class="ident">Test2D_DW_1</span></span>
<span>(</span><span>resultFileDirectory='.', name=None, rawOutput=False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Test2D_DW_1(generalTest):
    &#34;&#34;&#34; CTSimU test 2D-DW-1: Detector Unsharpness. &#34;&#34;&#34;

    def __init__(self, resultFileDirectory=&#34;.&#34;, name=None, rawOutput=False):
        generalTest.__init__(
            self,
            testName=&#34;2D-DW-1&#34;,
            name=name,
            nExpectedRuns=2,
            resultFileDirectory=resultFileDirectory,
            rawOutput=rawOutput)

        # Results for each sub test:
        self.results = []

        # ROI of imaged duplex wire: (622, 312) -- (1630, 678)

        duplexAngle = 3 * (math.pi/180.0)   # 3 deg duplex wire rotation
        duplexCenter = Vector(1126, 496)    # Center of duplex wire ROI

        self.profileLength = 1050
        self.profileRes    = 0.1
        self.profileWidth  = 20

        duplexDirection = Vector(self.profileLength/2, 0)   # points &#34;right&#34;
        duplexDirection.rotate_2D_xy(duplexAngle)   # Rotate by angle of duplex wire arrangement

        self.p0 = duplexCenter - duplexDirection
        self.p1 = duplexCenter + duplexDirection

        self.currentNominalSRb = 0
        self.currentPixelSize  = 0
        self.currentSDD        = 0
        self.currentSOD        = 0


    def prepare(self):
        &#34;&#34;&#34; Preparations before the test will be run with the images from the pipeline. &#34;&#34;&#34;
        self.prepared = True

    def prepareRun(self, i):
        if i &lt; len(self.subtests):
            self.jsonScenarioFile = &#34;2D-DW-1_Detektor1_2021-05-26v01r01dp.json&#34;
            if self.subtests[i] == &#34;SR150&#34;:
                self.jsonScenarioFile = &#34;2D-DW-1_Detektor2_2021-05-26v01r01dp.json&#34;

            if self.jsonScenarioFile is not None:
                scenario = Scenario(json_dict=json_from_pkg(pkg_scenario(self.jsonScenarioFile)))

                self.currentNominalSRb = scenario.detector.unsharpness.basic_spatial_resolution.get()

                if self.currentNominalSRb is None:
                    raise Exception(&#34;Test {name}: Cannot find &#39;basic_spatial_resolution&#39; value in JSON scenario description: {json}&#34;.format(name=self.name, json=self.jsonScenarioFile))

                self.currentPixelSize = scenario.detector.pixel_pitch.u.get()
                if self.currentPixelSize is None:
                    raise Exception(&#34;Test {name}: Cannot find &#39;pixel_pitch/u&#39; value in JSON scenario description: {json}&#34;.format(name=self.name, json=self.jsonScenarioFile))

                geo = scenario.current_geometry()
                geo.update()
                self.currentSDD = geo.SDD
                if self.currentSDD is None:
                    raise Exception(f&#34;Test {self.name}: Calculation of SDD failed.&#34;)

                self.currentSOD = geo.SOD
                if self.currentSOD is None:
                    raise Exception(f&#34;Test {self.name}: Calculation of SOD failed.&#34;)
            else:
                raise Exception(&#34;Test {name}: Cannot open JSON scenario description: {json}&#34;.format(name=self.name, json=self.jsonScenarioFile))

            # Prepare this test run:
            self.prepare()
            self.results.append(Test2D_DW_1_results())
            self.results[i].SRb_nominal = self.currentNominalSRb
            self.results[i].pixelSize = self.currentPixelSize
            self.results[i].SDD = self.currentSDD
            self.results[i].SOD = self.currentSOD

        else:
            if len(self.subtests) == 0:
                raise Exception(&#34;Please provide keywords that identify which metadata file belongs to which subtest. Test {testname} accepts two keywords: &#39;SR50&#39; for 50um basic spatial resolution and &#39;SR100&#39; for 100um basic spatial resolution.&#34;.format(testname=self.testName))
            else:
                raise Exception(&#34;Number of provided image metadata files exceeds number of test runs ({expected}).&#34;.format(expected=len(self.subtests)))

    def writeResultFile(self, subname, results):
        pos  = results.lineProfilePos
        prof = results.lineProfileGV

        profileText  = &#34;# Profile data\n&#34;
        profileText += &#34;# s [px]\tGV&#34;
        profileText += &#34;\n&#34;

        for j in range(len(pos)):
            profileText += &#34;{pos:.2f}\t{GV}&#34;.format(pos=pos[j], GV=prof[j])
            profileText += &#34;\n&#34;

        profileFileName = &#34;{dir}/{name}_{subname}_profile.txt&#34;.format(dir=self.resultFileDirectory, name=self.name, subname=subname)
        with open(profileFileName, &#39;w&#39;) as profileFile:
            profileFile.write(profileText)
            profileFile.close()

        resultText  = &#34;# Results\n&#34;
        resultText += &#34;# \n&#34;
        resultText += &#34;# iSRb: {:.5f} mm\n&#34;.format(results.SRb_interpolated)
        resultText += &#34;# \n&#34;
        resultText += &#34;# Interpolation function: f(x) = axÂ²+bx+c\n&#34;
        resultText += &#34;# a: {:.5f}\n&#34;.format(results.interpolation_a)
        resultText += &#34;# b: {:.5f}\n&#34;.format(results.interpolation_b)
        resultText += &#34;# c: {:.5f}\n&#34;.format(results.interpolation_c)
        resultText += &#34;# \n&#34;
        resultText += &#34;# Wire spacing [mm]\tModulation depth [%]\n&#34;

        for j in range(len(results.wireSpacings)):
            resultText += &#34;{ws:.3f}\t{md:.3f}&#34;.format(ws=results.wireSpacings[j], md=results.modulationDepths[j])
            resultText += &#34;\n&#34;

        resultTextFileName = &#34;{dir}/{name}_{subname}_results.txt&#34;.format(dir=self.resultFileDirectory, name=self.name, subname=subname)
        with open(resultTextFileName, &#39;w&#39;) as resultFile:
            resultFile.write(resultText)
            resultFile.close()


    def run(self, image):
        self.prepareRun(self.currentRun)
        i = self.currentRun
        subtestName = self.subtests[i]

        self.results[i].lineProfileGV, self.results[i].lineProfilePos, stepsize = image.lineProfile(x0=self.p0.x(), y0=self.p0.y(), x1=self.p1.x(), y1=self.p1.y(), width=self.profileWidth, resolution=self.profileRes)

        print(&#34;Pixel Size: {}, SOD: {}, SDD: {}&#34;.format(self.currentPixelSize, self.currentSOD, self.currentSDD))

        # Use Bendix&#39; iSRb tool to evaluate the basic spatial resolution
        tool = Interpolation(im=image.px, pixelsize=self.currentPixelSize, SOD=self.currentSOD, SDD=self.currentSDD, wire_length=15, wire_spacing=[0.8, 0.63, 0.5, 0.4, 0.32, 0.25, 0.2, 0.16, 0.13, 0.1, 0.08, 0.063, 0.05])

        # The line profile has already been measured. Provide it to the tool:
        tool.measure = self.results[i].lineProfileGV
        tool.ind     = self.results[i].lineProfilePos
        tool.calc_dips(prominence=100)
        tool.interpolate()

        if tool.dip20 is not None:
            self.results[i].SRb_interpolated = tool.dip20
        else:
            self.results[i].SRb_interpolated = 0
        print(&#34;iSRb: {:.5f} mm&#34;.format(self.results[i].SRb_interpolated))

        self.results[i].criticalIndex = tool.criticalIndex

        self.results[i].wireSpacings = tool.wire_spacing
        self.results[i].modulationDepths = tool.dips[0:len(tool.wire_spacing)]

        self.results[i].interpolation_wireSpacings = tool.inter[0]
        self.results[i].interpolation_modulationDepths = tool.inter[1]
        self.results[i].interpolation_a = tool.a
        self.results[i].interpolation_b = tool.b
        self.results[i].interpolation_c = tool.c

        self.writeResultFile(subtestName, self.results[i])
        self.plotResults()
        self.currentRun += 1


        return image

    def followUp(self):
        pass

    def plotResults(self):
        i = self.currentRun
        subtestName = self.subtests[i]
        try:
            import matplotlib
            import matplotlib.pyplot
            from matplotlib.ticker import (MultipleLocator, FormatStrFormatter, AutoMinorLocator)

            matplotlib.use(&#34;agg&#34;)

            fig, (ax1, ax2) = matplotlib.pyplot.subplots(nrows=2, ncols=1, figsize=(9, 7.5))

            # Grey Value Profile:
            ax1.plot(self.results[i].lineProfilePos, self.results[i].lineProfileGV, linewidth=1.5, label=&#34;Measured&#34;, color=&#39;#1f77b4&#39;)

            ax1.set_xlabel(&#34;Horizontal distance in px&#34;)
            ax1.set_ylabel(&#34;Grey Value&#34;)
            #ax1.set_xlim([-3*self.results[i].nominalGaussianSigmaPX, 3*self.results[i].nominalGaussianSigmaPX])
            ax1.set_title(&#34;Grey Value Profile&#34;)
            #ax1.xaxis.set_ticklabels([])
            ax1.grid(visible=True, which=&#39;major&#39;, axis=&#39;both&#39;, color=&#39;#d9d9d9&#39;, linestyle=&#39;dashed&#39;)
            ax1.grid(visible=True, which=&#39;minor&#39;, axis=&#39;both&#39;, color=&#39;#e7e7e7&#39;, linestyle=&#39;dotted&#39;)
            ax1.legend(loc=&#39;best&#39;)


            # Contrast vs. Wire Spacing
            ax2.plot(self.results[i].interpolation_wireSpacings, self.results[i].interpolation_modulationDepths, linewidth=1.5, label=&#34;Interpolation&#34;, color=&#39;#ffaa00&#39;)

            ax2.plot(self.results[i].wireSpacings, self.results[i].modulationDepths, &#39;o&#39;, markersize=4.0, label=&#34;Measured modulation depth&#34;, color=&#39;#1f77b4&#39;)
            if self.results[i].criticalIndex is not None:
                ci = self.results[i].criticalIndex
                ax2.plot(self.results[i].wireSpacings[ci], self.results[i].modulationDepths[ci], &#39;o&#39;, markersize=9.0, label=&#34;Critical Pair&#34;, markerfacecolor=&#39;none&#39;, markeredgecolor=&#39;black&#39;)
            ax2.plot(self.results[i].SRb_interpolated, 20, &#39;x&#39;, markersize=7.0, label=&#34;iSRb&#34;, color=&#39;#ff0000&#39;)

            ax2.set_xlabel(&#34;Wire spacing in mm&#34;)
            ax2.set_ylabel(&#34;Modulation depth in %&#34;)
            ax2.set_xlim([0.9, 0])
            ax2.set_title(&#34;SRb Interpolation&#34;)
            #ax2.xaxis.set_ticklabels([])
            ax2.grid(visible=True, which=&#39;major&#39;, axis=&#39;both&#39;, color=&#39;#d9d9d9&#39;, linestyle=&#39;dashed&#39;)
            ax2.grid(visible=True, which=&#39;minor&#39;, axis=&#39;both&#39;, color=&#39;#e7e7e7&#39;, linestyle=&#39;dotted&#39;)
            ax2.legend(loc=&#39;best&#39;)

            ax22 = ax2.twiny()
            ax22.set_xlim(ax2.get_xlim())
            ax22.set_xticks(numpy.array([0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.05, 0]))
            ax22.set_xticklabels([&#34;0.56&#34;, &#34;0.625&#34;, &#34;0.714&#34;, &#34;0.83&#34;, &#34;1&#34;, &#34;1.25&#34;, &#34;1.67&#34;, &#34;2.5&#34;, &#34;5&#34;, &#34;10&#34;, &#34;âˆž&#34;])
            ax22.set_xlabel(&#34;Spatial resolution in lp/mm&#34;)


            fig.tight_layout(pad=2.5)

            plotFilename = &#34;{dir}/{name}_{subname}_results.png&#34;.format(dir=self.resultFileDirectory, name=self.name, subname=subtestName)
            matplotlib.pyplot.savefig(plotFilename)
            fig.clf()
            matplotlib.pyplot.close(&#39;all&#39;)
        except Exception as e:
            log(f&#34;Warning: Error plotting results for test {self.name}, {subtestName} using matplotlib: {e}&#34;)</code></pre>
</details>
<div class="desc"><p>CTSimU test 2D-DW-1: Detector Unsharpness.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="ctsimu.test.generalTest" href="../test.html#ctsimu.test.generalTest">generalTest</a></li>
<li><a title="ctsimu.processing.step.Step" href="../processing/step.html#ctsimu.processing.step.Step">Step</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.prepare"><code class="name flex">
<span>def <span class="ident">prepare</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def prepare(self):
    &#34;&#34;&#34; Preparations before the test will be run with the images from the pipeline. &#34;&#34;&#34;
    self.prepared = True</code></pre>
</details>
<div class="desc"><p>Preparations before the test will be run with the images from the pipeline.</p></div>
</dd>
<dt id="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.prepareRun"><code class="name flex">
<span>def <span class="ident">prepareRun</span></span>(<span>self, i)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def prepareRun(self, i):
    if i &lt; len(self.subtests):
        self.jsonScenarioFile = &#34;2D-DW-1_Detektor1_2021-05-26v01r01dp.json&#34;
        if self.subtests[i] == &#34;SR150&#34;:
            self.jsonScenarioFile = &#34;2D-DW-1_Detektor2_2021-05-26v01r01dp.json&#34;

        if self.jsonScenarioFile is not None:
            scenario = Scenario(json_dict=json_from_pkg(pkg_scenario(self.jsonScenarioFile)))

            self.currentNominalSRb = scenario.detector.unsharpness.basic_spatial_resolution.get()

            if self.currentNominalSRb is None:
                raise Exception(&#34;Test {name}: Cannot find &#39;basic_spatial_resolution&#39; value in JSON scenario description: {json}&#34;.format(name=self.name, json=self.jsonScenarioFile))

            self.currentPixelSize = scenario.detector.pixel_pitch.u.get()
            if self.currentPixelSize is None:
                raise Exception(&#34;Test {name}: Cannot find &#39;pixel_pitch/u&#39; value in JSON scenario description: {json}&#34;.format(name=self.name, json=self.jsonScenarioFile))

            geo = scenario.current_geometry()
            geo.update()
            self.currentSDD = geo.SDD
            if self.currentSDD is None:
                raise Exception(f&#34;Test {self.name}: Calculation of SDD failed.&#34;)

            self.currentSOD = geo.SOD
            if self.currentSOD is None:
                raise Exception(f&#34;Test {self.name}: Calculation of SOD failed.&#34;)
        else:
            raise Exception(&#34;Test {name}: Cannot open JSON scenario description: {json}&#34;.format(name=self.name, json=self.jsonScenarioFile))

        # Prepare this test run:
        self.prepare()
        self.results.append(Test2D_DW_1_results())
        self.results[i].SRb_nominal = self.currentNominalSRb
        self.results[i].pixelSize = self.currentPixelSize
        self.results[i].SDD = self.currentSDD
        self.results[i].SOD = self.currentSOD

    else:
        if len(self.subtests) == 0:
            raise Exception(&#34;Please provide keywords that identify which metadata file belongs to which subtest. Test {testname} accepts two keywords: &#39;SR50&#39; for 50um basic spatial resolution and &#39;SR100&#39; for 100um basic spatial resolution.&#34;.format(testname=self.testName))
        else:
            raise Exception(&#34;Number of provided image metadata files exceeds number of test runs ({expected}).&#34;.format(expected=len(self.subtests)))</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.writeResultFile"><code class="name flex">
<span>def <span class="ident">writeResultFile</span></span>(<span>self, subname, results)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def writeResultFile(self, subname, results):
    pos  = results.lineProfilePos
    prof = results.lineProfileGV

    profileText  = &#34;# Profile data\n&#34;
    profileText += &#34;# s [px]\tGV&#34;
    profileText += &#34;\n&#34;

    for j in range(len(pos)):
        profileText += &#34;{pos:.2f}\t{GV}&#34;.format(pos=pos[j], GV=prof[j])
        profileText += &#34;\n&#34;

    profileFileName = &#34;{dir}/{name}_{subname}_profile.txt&#34;.format(dir=self.resultFileDirectory, name=self.name, subname=subname)
    with open(profileFileName, &#39;w&#39;) as profileFile:
        profileFile.write(profileText)
        profileFile.close()

    resultText  = &#34;# Results\n&#34;
    resultText += &#34;# \n&#34;
    resultText += &#34;# iSRb: {:.5f} mm\n&#34;.format(results.SRb_interpolated)
    resultText += &#34;# \n&#34;
    resultText += &#34;# Interpolation function: f(x) = axÂ²+bx+c\n&#34;
    resultText += &#34;# a: {:.5f}\n&#34;.format(results.interpolation_a)
    resultText += &#34;# b: {:.5f}\n&#34;.format(results.interpolation_b)
    resultText += &#34;# c: {:.5f}\n&#34;.format(results.interpolation_c)
    resultText += &#34;# \n&#34;
    resultText += &#34;# Wire spacing [mm]\tModulation depth [%]\n&#34;

    for j in range(len(results.wireSpacings)):
        resultText += &#34;{ws:.3f}\t{md:.3f}&#34;.format(ws=results.wireSpacings[j], md=results.modulationDepths[j])
        resultText += &#34;\n&#34;

    resultTextFileName = &#34;{dir}/{name}_{subname}_results.txt&#34;.format(dir=self.resultFileDirectory, name=self.name, subname=subname)
    with open(resultTextFileName, &#39;w&#39;) as resultFile:
        resultFile.write(resultText)
        resultFile.close()</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="ctsimu.test.generalTest" href="../test.html#ctsimu.test.generalTest">generalTest</a></b></code>:
<ul class="hlist">
<li><code><a title="ctsimu.test.generalTest.followUp" href="../processing/step.html#ctsimu.processing.step.Step.followUp">followUp</a></code></li>
<li><code><a title="ctsimu.test.generalTest.plotResults" href="../test.html#ctsimu.test.generalTest.plotResults">plotResults</a></code></li>
<li><code><a title="ctsimu.test.generalTest.run" href="../processing/step.html#ctsimu.processing.step.Step.run">run</a></code></li>
<li><code><a title="ctsimu.test.generalTest.setName" href="../test.html#ctsimu.test.generalTest.setName">setName</a></code></li>
<li><code><a title="ctsimu.test.generalTest.setRawOutput" href="../test.html#ctsimu.test.generalTest.setRawOutput">setRawOutput</a></code></li>
<li><code><a title="ctsimu.test.generalTest.setResultFileDirectory" href="../test.html#ctsimu.test.generalTest.setResultFileDirectory">setResultFileDirectory</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1_results"><code class="flex name class">
<span>class <span class="ident">Test2D_DW_1_results</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Test2D_DW_1_results:
    &#34;&#34;&#34; Results for one sub-test. &#34;&#34;&#34;

    def __init__(self):
        self.lineProfileGV  = None   # Profile positions
        self.lineProfilePos = None   # Profile values

        # For the modulation depth vs. wire spacing diagram:
        self.wireSpacings     = None
        self.modulationDepths = None

        self.interpolation_wireSpacings = None
        self.interpolation_modulationDepths = None

        self.interpolation_a = 0
        self.interpolation_b = 0
        self.interpolation_c = 0

        self.pixelSize   = None
        self.SDD         = None
        self.SOD         = None

        self.criticalIndex = None   # Last wire pair with dip &gt; 20%.
        self.SRb_nominal  = None
        self.SRb_interpolated = None</code></pre>
</details>
<div class="desc"><p>Results for one sub-test.</p></div>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="pdoc Home" href="https://bamresearch.github.io/ctsimu-toolbox">
<img src="https://bamresearch.github.io/ctsimu-toolbox/toolbox.png" alt=""> ctsimu
</a>
</header>
<div class="toc">
<ul>
<li><a href="#test-2d-dw-1-detector-unsharpness">Test 2D-DW-1: Detector unsharpness</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ctsimu.evaluation" href="index.html">ctsimu.evaluation</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1" href="#ctsimu.evaluation.test2D_DW_1.Test2D_DW_1">Test2D_DW_1</a></code></h4>
<ul class="">
<li><code><a title="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.prepare" href="#ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.prepare">prepare</a></code></li>
<li><code><a title="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.prepareRun" href="#ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.prepareRun">prepareRun</a></code></li>
<li><code><a title="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.writeResultFile" href="#ctsimu.evaluation.test2D_DW_1.Test2D_DW_1.writeResultFile">writeResultFile</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="ctsimu.evaluation.test2D_DW_1.Test2D_DW_1_results" href="#ctsimu.evaluation.test2D_DW_1.Test2D_DW_1_results">Test2D_DW_1_results</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
